---
const pathname = Astro.url.pathname;
const base = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
const links = [
  { href: '/', label: 'Accueil' },
  { href: '/prestations', label: 'Prestations' },
  { href: '/formations', label: 'Formations' },
  { href: '/contact', label: 'Contact' },
];
const normalizePath = (path) => (path.endsWith('/') && path !== '/' ? path.slice(0, -1) : path);
const normalizedPathname = normalizePath(pathname);
const isActive = (href) => {
  const normalizedHref = normalizePath(href);
  return normalizedHref === '/'
    ? normalizedPathname === '/'
    : normalizedPathname.startsWith(normalizedHref);
};
const trimLeadingSlash = (value) => {
  let result = value;
  while (result.startsWith('/')) result = result.slice(1);
  return result;
};
const toBaseHref = (href) => `${base}${trimLeadingSlash(href)}`;
---
<header class="fixed left-0 right-0 top-0 z-50 border-b border-gold/30 bg-ivory/92 backdrop-blur-md">
  <div class="container-shell flex h-20 items-center justify-between gap-6">
    <a href={toBaseHref('/')} class="flex items-center gap-3">
      <img src={`${base}logo.png`} alt="Elodie Mignot - Esthétique" class="h-10 w-auto sm:h-12" />
      <span class="hidden text-[0.62rem] font-medium uppercase tracking-[0.24em] text-cocoa/80 lg:inline">
        Elodie Mignot - Beauté, cosmétique et soins
      </span>
    </a>
    <nav class="hidden items-center gap-8 text-[0.7rem] font-semibold uppercase tracking-[0.2em] md:flex">
      {links.map((link) => (
        <a
          href={toBaseHref(link.href)}
          class:list={[
            'relative pb-1 transition-colors duration-200',
            isActive(link.href) ? 'text-ink' : 'text-cocoa/70 hover:text-ink',
          ]}
        >
          {link.label}
          <span
            class:list={[
              'absolute -bottom-1 left-0 h-px w-full bg-[linear-gradient(90deg,_rgba(183,154,107,0),_rgba(183,154,107,1),_rgba(183,154,107,0))] transition-opacity duration-200',
              isActive(link.href) ? 'opacity-100' : 'opacity-0',
            ]}
          ></span>
        </a>
      ))}
    </nav>
    <div class="flex items-center gap-3">
      <a
        href={toBaseHref('/contact')}
        class="hidden rounded-full border border-gold/70 bg-[linear-gradient(145deg,_rgba(16,16,16,1),_rgba(32,32,32,0.98))] px-5 py-2 text-[0.65rem] font-semibold uppercase tracking-[0.22em] text-ivory transition duration-200 hover:-translate-y-0.5 hover:border-gold md:inline-flex"
      >
        Réserver
      </a>
      <details class="relative md:hidden">
        <summary
          class="list-none inline-flex h-10 w-10 items-center justify-center rounded-full border border-ink/20 bg-white text-ink"
          aria-label="Ouvrir le menu"
        >
          <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
          </svg>
        </summary>
        <div class="absolute right-0 mt-3 w-64 rounded-2xl border border-gold/35 bg-ivory p-4 shadow-lift">
          <p class="mb-3 border-b border-gold/30 pb-2 text-[0.62rem] font-semibold uppercase tracking-[0.2em] text-cocoa/70">
            Elodie Mignot - Beauté, cosmétique et soins
          </p>
          <nav class="flex flex-col gap-3 text-[0.68rem] font-semibold uppercase tracking-[0.2em]">
            {links.map((link) => (
              <a
                href={toBaseHref(link.href)}
                class:list={[isActive(link.href) ? 'text-ink' : 'text-cocoa/70 hover:text-ink']}
              >
                {link.label}
              </a>
            ))}
          </nav>
        </div>
      </details>
    </div>
  </div>
</header>
